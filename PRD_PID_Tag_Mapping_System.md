# P&ID Tag Mapping System - Product Requirements Document

## 1. 개요

### 1.1 프로젝트 개요
Searchable PDF P&ID에서 equipment, line, instrument 태그를 자동 인식하고, 태그 간의 관계를 수동 매핑하여 Excel 형태로 출력하는 웹 애플리케이션

### 1.2 목표 사용자
- **Primary**: EPC 엔지니어
- **사용 규모**: 하루 100장의 P&ID 처리
- **사용 형태**: 단일 사용자 (향후 팀 협업 기능 확장 예정)

## 2. 핵심 기능 요구사항

### 2.1 PDF 처리
- **입력 형태**: 벡터 기반 CAD 출력 PDF
- **처리 규모**: 페이지당 50~100개 태그
- **지원 기능**: PDF 뷰어, 줌/팬, 텍스트 검색

### 2.2 태그 인식 및 시각화 시스템
- **사용자 정의 정규식**: 사용자가 직접 입력하는 정규식 패턴으로 태그 인식
- **공간 분석 매칭**: Instrument 태그는 Number와 Function의 위치 관계로 인식
- **패턴 테스트**: 정규식 패턴을 실시간으로 테스트할 수 있는 기능
- **실시간 PDF 하이라이트**: 인식된 태그들이 PDF 위에 색상별로 시각화
  - Equipment: 녹색 하이라이트
  - Line: 노란색 하이라이트  
  - Instrument: 파란색 하이라이트 (Function: Number 형식 라벨)
- **페이지별 태그 필터링**: 현재 페이지의 태그만 우측 패널에 표시
- **태그 선택 동기화**: 패널에서 태그 선택 시 PDF에서 시각적 강조
- **자동 태그 인식**: PDF 텍스트 추출 + 사용자 정의 패턴 매칭
- **수동 태그 지정**: 자동 인식 실패 시 사용자 직접 영역 선택

### 2.3 관계 매핑 시스템
- **핫키 기반 매핑**:
  - `R` 키: 연결 관계 모드 (A → B)
  - `I` 키: 설치 관계 모드 (A installed on B)
  - `Esc`: 모드 취소
- **매핑 방식**: 핫키로 모드 진입 → 태그 클릭 순서로 관계 생성

### 2.4 데이터 저장 및 관리
- **저장 방식**: 로컬 저장
- **자동 저장**: 작업 진행 중 자동 저장 기능
- **프로젝트 관리**: 여러 P&ID 파일을 하나의 프로젝트로 관리

## 3. 출력 요구사항

### 3.1 Excel 출력 구조

**Equipment List:**
- P&ID Number
- Equipment Tag  
- Equipment Type
- Short Specification (P&ID 명기된 사양)

**Line List:**
- P&ID Number
- Line Tag
- Line Size
- From Equipment
- To Equipment

**Instrument List:**
- P&ID Number
- Instrument Tag
- Instrument Type
- Installed On (Equipment/Line)

### 3.2 출력 기능
- 선택적 시트 출력 (Equipment/Line/Instrument 개별 또는 통합)
- Excel 템플릿 적용 기능
- 데이터 필터링 및 정렬 옵션

## 4. UI/UX 요구사항

### 4.1 메인 화면 구성
```
┌─────────────────────────────────┬─────────────────┐
│           PDF Viewer            │   Tag Panel     │
│  - P&ID 표시                   │  - Equipment    │
│  - 줌/팬 기능                  │  - Line         │
│  - 태그 하이라이트             │  - Instrument   │
│  - 관계선 표시                 │  - 검색/필터    │
└─────────────────────────────────┴─────────────────┘
```

### 4.2 핵심 워크플로우
1. PDF 업로드 → 자동 태그 인식
2. 태그 검토 및 수동 추가/수정
3. 핫키 기반 관계 매핑
4. Excel 출력

### 4.3 사용성 요구사항
- 키보드 단축키 지원
- 실시간 프리뷰
- 작업 진행률 표시
- 오류 검증 및 경고 시스템
- **패턴 설정 UI**: 정규식 패턴 입력 및 관리 인터페이스
- **패턴 테스트**: 입력한 정규식의 실시간 검증 기능

## 5. 기술적 요구사항

### 5.1 플랫폼
- **형태**: 웹 애플리케이션
- **브라우저 호환성**: Chrome, Edge, Firefox 최신 버전

### 5.2 성능 요구사항
- **처리 용량**: 하루 100장 × 50~100개 태그 = 5,000~10,000개 태그
- **응답 시간**: 태그 인식 < 5초, 관계 매핑 실시간
- **파일 크기**: 최대 50MB PDF 파일 지원

### 5.3 구현된 기술 스택
- **Frontend**: Vanilla JavaScript ES6+ (모듈화된 클래스 구조)
- **PDF Processing**: PDF.js + Canvas API (하이라이트 오버레이)
- **패턴 인식**: 정규식 + 공간 분석 알고리즘
- **Storage**: LocalStorage + IndexedDB
- **Export**: SheetJS (XLSX)
- **UI**: CSS3 (Grid, Flexbox, 애니메이션)

## 6. MVP 범위

### 6.1 Phase 1 (MVP) ✅ COMPLETED
- [x] PDF 뷰어 및 기본 조작
- [x] 실시간 PDF 태그 하이라이트 시스템
- [x] 페이지별 태그 필터링 및 네비게이션
- [x] 태그 선택 동기화 (패널 ↔ PDF)
- [x] 사용자 정의 정규식 패턴 시스템
- [x] 패턴 설정 UI 및 실시간 테스트 기능
- [x] 공간 분석 기반 Instrument 태그 인식
- [x] 자동 태그 인식 (사용자 정의 패턴 + 위치 분석)
- [x] 수동 태그 지정
- [x] 핫키 기반 관계 매핑 (연결/설치)
- [x] Excel 출력 (Equipment/Line/Instrument 시트)
- [x] 로컬 저장/불러오기 및 자동 저장

### 6.2 Phase 2 (Enhancement)
- [ ] 고급 태그 인식 패턴
- [ ] 배치 처리 기능
- [ ] 템플릿 관리
- [ ] 데이터 검증 시스템
- [ ] 사용자 설정

### 6.3 Phase 3 (Team Features)
- [ ] 다중 사용자 지원
- [ ] 클라우드 저장
- [ ] 버전 관리
- [ ] 협업 기능

## 7. 성공 기준

### 7.1 정량적 지표
- 태그 자동 인식률: 85% 이상
- 하루 100장 처리 시간: 8시간 이내
- 시스템 응답 시간: 3초 이내

### 7.2 정성적 지표
- 사용자 작업 효율성 50% 향상
- 수작업 대비 오류율 90% 감소
- 직관적이고 빠른 인터페이스

## 8. 제약사항 및 위험요소

### 8.1 제약사항
- 벡터 기반 PDF만 지원 (스캔 이미지 PDF 제외)
- 표준 규격 미정의로 인한 다양한 태그 형식 대응 필요
- 브라우저 메모리 제한 (대용량 PDF 처리)

### 8.2 위험요소
- PDF 텍스트 추출 품질 변동
- 복잡한 P&ID에서의 태그 인식 정확도
- 사용자별 다른 태그 명명 규칙

---

**문서 버전**: v1.0  
**작성일**: 2025-08-22  
**검토 필요 사항**: 개발 일정, 예산, 기술적 검증